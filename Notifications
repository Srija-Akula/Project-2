# Real-Time Notifications with Django Channels (Step-by-Step)


## Users will receive **instant notifications** when:

* Someone sends a friend request
* Someone likes their post
* Someone comments on their post

Notifications will be delivered using **WebSockets** instead of HTTP polling.


## Requirements

Install required packages:

```bash
pip install channels channels-redis
```


## Step 1: Update `settings.py`

### Add Channels

```python
INSTALLED_APPS = [
    'channels',
    'notifications',
    ...
]
```

### ASGI Configuration

```python
ASGI_APPLICATION = 'core.asgi.application'
```

### Channel Layers (Redis)

```python
CHANNEL_LAYERS = {
    'default': {
        'BACKEND': 'channels_redis.core.RedisChannelLayer',
        'CONFIG': {
            'hosts': [('127.0.0.1', 6379)],
        },
    },
}
```


## Step 2: Update `asgi.py`

```python
import os
from channels.routing import ProtocolTypeRouter, URLRouter
from django.core.asgi import get_asgi_application
from channels.auth import AuthMiddlewareStack
import notifications.routing

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')

application = ProtocolTypeRouter({
    'http': get_asgi_application(),
    'websocket': AuthMiddlewareStack(
        URLRouter(
            notifications.routing.websocket_urlpatterns
        )
    ),
})
```


## Step 3: Create WebSocket Consumer

### `notifications/consumers.py`

```python
import json
from channels.generic.websocket import AsyncWebsocketConsumer

class NotificationConsumer(AsyncWebsocketConsumer):
    async def connect(self):
        self.user = self.scope['user']
        if self.user.is_anonymous:
            await self.close()
        else:
            self.group_name = f'user_{self.user.id}'
            await self.channel_layer.group_add(self.group_name, self.channel_name)
            await self.accept()

    async def disconnect(self, close_code):
        await self.channel_layer.group_discard(self.group_name, self.channel_name)

    async def send_notification(self, event):
        await self.send(text_data=json.dumps({
            'message': event['message']
        }))
```


## Step 4: WebSocket Routing

### `notifications/routing.py`

```python
from django.urls import re_path
from .consumers import NotificationConsumer

websocket_urlpatterns = [
    re_path(r'ws/notifications/$', NotificationConsumer.as_asgi()),
]
```


## Step 5: Send Notifications Using Signals

### Example: Like Notification

```python
from channels.layers import get_channel_layer
from asgiref.sync import async_to_sync

channel_layer = get_channel_layer()

async_to_sync(channel_layer.group_send)(
    f'user_{post.author.id}',
    {
        'type': 'send_notification',
        'message': f'{request.user.username} liked your post'
    }
)
```

You can trigger this inside:

* Like view
* Comment creation
* Friend request creation


## Step 6: Frontend WebSocket (Basic)

```javascript
const socket = new WebSocket('ws://127.0.0.1:8000/ws/notifications/');

socket.onmessage = function(event) {
    const data = JSON.parse(event.data);
    alert(data.message);
};
```


## Running the System

1. Start Redis server

```bash
redis-server
```

2. Run Django with ASGI

```bash
python manage.py runserver
```


## Result

1. Real-time notifications
2. WebSocket-based delivery
3. Scalable architecture
4. Industry-level feature



## Next Improvements

* Save notifications to DB
* Notification dropdown UI
* Mark as read (real-time)
* Push notifications

